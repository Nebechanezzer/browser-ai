<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Saner AI Chatbot</title>
  <script type="module">
    import { pipeline } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.10.0';

    let generator;
    let conversationHistory = '';

    window.addEventListener('DOMContentLoaded', async () => {
      const status = document.getElementById('status');
      const output = document.getElementById('output');
      const input = document.getElementById('user-input');
      const button = document.getElementById('submit');

      status.textContent = 'Loading model... please wait';

      // Load the text generation pipeline
      generator = await pipeline('text-generation', 'Xenova/distilgpt2');
      status.textContent = 'Model ready! Start chatting.';

      button.addEventListener('click', async () => {
        const userMessage = input.value.trim();
        if (!userMessage) return;
        input.value = '';
        
        output.innerHTML += `<p><b>You:</b> ${userMessage}</p>`;
        status.textContent = 'Bot is thinking...';

        // Add user message to conversation context
        conversationHistory += `User: ${userMessage}\nBot:`;

        const result = await generator(conversationHistory, {
          max_new_tokens: 50,
          temperature: 0.8,
          top_k: 50,
          repetition_penalty: 1.2
        });

        // Extract bot reply
        let reply = result[0].generated_text.replace(conversationHistory, '').split('\n')[0].trim();
        reply = reply.replace(/[^a-zA-Z0-9.,?!'"()\- ]/g, ''); // remove weird characters

        // Show reply
        output.innerHTML += `<p><b>Bot:</b> ${reply}</p>`;
        status.textContent = 'Ready!';

        // Update context
        conversationHistory += ` ${reply}\n`;
      });

      // Pressing enter submits the message
      input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') button.click();
      });
    });
  </script>
</head>
<body style="font-family: sans-serif; padding: 2em;">
  <h2>ðŸ§  Saner AI Chatbot (DistilGPT2)</h2>
  <div id="status">Initializing...</div>
  <div id="output" style="margin: 1em 0; background: #f0f0f0; padding: 1em; border-radius: 8px; min-height: 100px;"></div>
  <input id="user-input" type="text" style="width: 70%;" placeholder="Say something..." />
  <button id="submit">Send</button>
</body>
</html>
